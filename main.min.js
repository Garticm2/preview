(function(){
class Preview{static CANVAS_WIDTH=758;static CANVAS_HEIGHT=424;static CANVAS_DENSITY=2;static SCALE_PADDING=80;static TYPE={IMAGE:"image",TEXT:"text",ANIMATION:"animation",MULTI_PIECE:"multi-piece",AI_IMAGE:"ai-image"};static TARGET_ORIGIN="https://garticphone.com";constructor(){window.addEventListener("beforeunload",this.onBeforeUnload.bind(this));window.addEventListener("resize",this.onResize.bind(this));window.addEventListener("message",this.onMessage.bind(this));window.opener.postMessage({type:"gp-preview-request-draw-function"},
Preview.TARGET_ORIGIN);this.render()}render(){this.container=document.querySelector(".container");const a=document.querySelector(".wrapper");this.canvas=document.createElement("canvas");this.canvas.className="canvas";this.canvas.width=Preview.CANVAS_WIDTH*Preview.CANVAS_DENSITY;this.canvas.height=Preview.CANVAS_HEIGHT*Preview.CANVAS_DENSITY;a.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#FFFFFF";this.text=document.createElement("div");this.text.className="text";
a.appendChild(this.text);this.calcScale()}onBeforeUnload(a){window.opener.postMessage({type:"gp-preview-win-closed"},Preview.TARGET_ORIGIN)}onResize(a){this.calcScale()}onMessage(a){const {type:d,data:b,itemType:c}=a.data;switch(d){case "data":this.container.dataset.type=c;switch(c){case Preview.TYPE.IMAGE:Array.isArray(b)&&this.renderImage(b);break;case Preview.TYPE.TEXT:this.setText(b)}break;case "clear":this.clear();break;case "draw_function":this.drawFunction=(new Function(`return ${a.data.drawFunctionString}`))()}}renderImage(a){this.clearCanvas();
this.drawFunction(this.ctx,a,Preview.CANVAS_DENSITY,!0,!1);this.canvas.classList.add("rendered");this.canvas.style.zIndex=1}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.canvas.classList.remove("rendered")}calcScale(){this.container.style.transform=`scale(${this.getScale()})`}setText(a){this.text.textContent=a;this.canvas.style.zIndex=1}clear(){this.clearCanvas();this.canvas.style.zIndex="";this.text.style.zIndex="";delete this.container.dataset.type}getScale(){let a=
window.innerWidth/(Preview.CANVAS_WIDTH+Preview.SCALE_PADDING);a*(Preview.CANVAS_HEIGHT+Preview.SCALE_PADDING)>window.innerHeight&&(a=window.innerHeight/(Preview.CANVAS_HEIGHT+Preview.SCALE_PADDING));return Math.min(1,a)}}new Preview;
}).call(this)
